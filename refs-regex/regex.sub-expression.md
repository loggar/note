정규 표현식 - 하위 표현식(sub expression)
http://sweeper.egloos.com/3064687 

```
1. 하위 표현식

"정규 표현석 - 수량자" 에서 단어 하나가 여러번 일치하는 경우를 살펴 보았다.

\d+는 하나 이상 연속된 숫자와 일치하고, https?는 http 또는 https와 일치한다.
수량자는 자기 바로 앞에 있는 문자나 메타 문자에 적용한다.

예를 들어, HTML 개발자는 단어 사이에 공백을 확실히 유지할 목적으로 주로 강제 공백을 단어 사이에 넣는다.
강제 공백이 두번 연속 잘못 입력된 곳을 찾는 아래 예제를 살펴보자.

[예문]
This is non breaking&nbsp;space exmple.
Non breaking&nbsp;&nbsp;space is for forcing space in HTML.

[정규 표현식]
\&nbsp\;{2,}

[결과]
This is non breaking&nbsp;space exmple.
Non breaking&nbsp;&nbsp;space is for forcing space in HTML.

뭐 의도한 바는 알겠으나, {2,} 수량자는 바로 앞의 문자나 집합에 대한 수량자이다.
고로, 위 정규 표현식이 의미하는 것은 ";"가 2개 이상인 것을 일치시키라는 것이다.

바로 이러한 문제를 해결하는 데 하위 표현식이 필요하다.

하위 표현식은 정규 표현식 안에 속한 일부 표현식을 한 항목으로 다루도록 하나로 묶은 것을 의미한다.
하위 표현식은 () 괄호 사이에 사용한다.

곧바로 위 예제를 하위 표현식을 사용하여 원래 목적에 부합하도록 수정해 보자.

[정규 표현식]
(\&nbsp\;){2,}

[결과]
This is non breaking&nbsp;space exmple.
Non breaking&nbsp;&nbsp;space is for forcing space in HTML.

\&npsp\;를 ()로 묶어 하위 표현식으로 표현하니, {2,} 수량자가 하위 표현식에 대응되어, 2개 이상 연속된 강제 공백을 제대로 찾을 수 있게 되었다.

하위 표현식을 이용하여, 올바른 IP 형식인지 검사하는 예제를 하나 더 살펴보도록 하자.

[예문]
Ping www.daum.net [117.52.2.25] 32 bytes data used.

[정규 표현식]
(\d{1,3}\.){3}\d{1,3}

[결과]
Ping www.daum.net [117.52.2.25] 32 bytes data used.

위에서 사용했던 정규 표현식을 하나씩 까보면...
한자리~세자리 숫자와 .(마침표)를 하위 표현식으로 묶기 위해 (\d{1,3}\.)
위 하위 표현식을 정확히 3번 반복하기 위해 {3}
그리고 마지막 한자리~세자리 숫자를 표현하기 위해 \d{1,3}

문법적으로야 IP 체크를 정확하게 하고 있지만, 정규 표현식의 경우 해당 문자가 어떤 의미를 가지는지는 모르기 때문에,
999.99.9.999 같은 엄한 숫자로 이루어진 IP 역시 위 정규 표현식으로는 일치하는 결과가 나온다.
이 문제에 대해서는 하위 표현식 중첩 챕터에서 더 자세하게 살펴 보자.

하위 표현식은 상당히 중요한 문법이기에, 추가 예제까지 살펴본 뒤 중첩 챕터로 넘어가도록 하겠다.

이 예제는 하위 표현식의 반복이 아닌, |(OR) 연산자 사용시에 대한 예제이다.
사용자 기록에서 연도를 일치시키려 한다.

[예문]
ID:042
SEX:M
DOB:1977-07-25
STATUS:ACTIVE

[정규 표현식]
19|20\d{2}

[결과]
ID:042
SEX:M
DOB:1977-07-25
STATUS:ACTIVE

이 예제에서는 1900년대 또는 2000년대의 숫자를 일치시키려 했다.
하지만, |(OR) 연산자는 자신의 왼편(lhs)과 오른편(rhs)에 각각 무엇이 있는지 살펴보는데,
위 정규 표현식에서의 lhs는 19, rhs는 20\d{2}가 되기에 결국 19 또는 20XX의 의미가 되어 버리는 것이다.

따라서, 이 문제를 해결하려면 정규 표현식을 아래와 같이 하위 표현식을 사용하는 방식으로 변경해야 한다.

[정규 표현식]
(19|20)\d{2}

[결과]
ID:042
SEX:M
DOB:1977-07-25
STATUS:ACTIVE


2. 하위 표현식 중첩

하위 표현식은 중첩해서 사용할 수 있으며, 중첩의 횟수나 깊이에 제한이 없다.

증첩되는 능력 덕분에 하위 표현식은 매우 강력한 표현도 만들 수 있다.
하지만, 표현식의 시인성을 상당히 떨어트릴 수 있으며, 정규 표현식 엔진에 따라 많은 성능 저하를 불러오기도 한다.
고로, 하위 표현식을 도저히 복잡해서 보지 못할 정도로는 작성하지 않는 것이 좋다.

위에서 살펴본 IP 체크의 문제점을 다시 한 번 되짚어 보자.

[정규 표현식]
(\d{1,3}\.){3}\d{1,3}

위 정규 표현식으로 형식은 일치시킬 수 있지만, 값의 유효성까지는 검증하지 못한다 했다.
(999.999.999.999 같은 녀석들 말이다)

정규 표현식은 문자를 일치시킬 뿐이지, 문자가 의미하는 바에 대해서는 아무런 지식이 없다.
또, 수학적 연산을 사용할 수도 없다.
우리가 할 수 있는 것은 일치해야 할 것과 일치하지 말아야 할 것을 명확하게 정의하는 것이다.

다음은 IP 주소를 구성하는 각 숫자 묶음을 유효한 조합으로 정의하는 규칙이다.
모든 한자리 숫자 또는 두자리 숫자
1로 시작하는 세자리 숫자
2로 시작하면서 두번째 자리 숫자가 0과 4사이의 모든 세자리 숫자
25로 시작하면서 세번째 자리 숫자가 0과 5사이의 모든 세자리 숫자

위 규칙들을 차례대로 하나씩 정규 표현식으로 표현하면, 아래와 같다.
\d{1,2}
1\d{2}
2[0-4]\d
25[0-5]

이들을 하나씩 하위 표현식으로 묶어 중첩시켜 보자.

[정규 표현식]
(((\d{1,2})|(1\d{2})|(2[0-4]\d)|(25[0-5))\.){3}((\d{1,2})|(1\d{2})|(2[0-4]\d)|(25[0-5))

미리 하나씩 다 살펴보고 작성하긴 했지만, 캬~ 이거 참 보기가 난감할 정도이다.

이것은 예를 들기 위해 작성한 것이고, 실제로 이러한 정규 표현식을 잘 사용하지는 않는다.
만약 이렇게 많은 중첩으로 작성된 정규 표현식을 접한다면,
가장 깊숙히 중첩된 애들부터 하나씩 차근차근 분석해가며 전체 중첩으로 해석을 확대하는 수 밖에 없다.
```
