정규 표현식 - 전후방 탐색(lookaround)
http://sweeper.egloos.com/3064808

```
1. 전후방 탐색의 필요성

전후방 탐색이 필요한 예제부터 살펴보자.

여기서는 웹 페이지에서 제목을 추출해야 한다고 가정한다.
HTML 페이지 제목은 HTML 코드에서 <HEAD> 구역 내의 <TITLE>과 </TITLE> 태그 사이에 있다.

[예문]
<HEAD>
<TITLE>SooKkaRak's homepage</TITLE>
</HEAD>

[정규 표현식]
\<([Tt][Ii][Tt][Ll][Ee])\>.*?\<\/\1\>

[결과]
<HEAD>
<TITLE>SooKkaRak's homepage</TITLE>
</HEAD>

[Tt][Ii][Tt][Ll][Ee]를 두번 쓰기 귀찮아서 하위 표현식으로 묶고, 종료 태그에서는 역참조하였다.

무튼 이러한 방식으로는 딱 정확하게 "SooKkaRak's homepage"만 찾을 수가 없다.
이러한 경우 정확하게 일치하는 지점을 지정할 수 있는 전후방 탐색이 필요하다.


2. 전방 탐색 - 앞으로 찾기

전방 탐색은 실제로는 하위 표현식이며, 하위 표현식과 같은 형식으로 작성한다.
전방 탐색 문법은 ?= 로 시작하고, 등호 다음에 일치할 텍스트가 오는 하위 표현식이다.
즉, (?=일치할 텍스트)의 형식인 것이다.

그리고, 전후방 탐색은 일치 영역을 발견해도 그 값을 반환하지 않으며, 그저 위치에 대한 힌트만 제공한다.
전방 탐색은 일치 영역 앞까지, 후방 탐색은 일치 영역 뒤부터 일치시키라고 힌트를 준다.

본문에는 URL 목록이 있고, 각 URL에서 프로토콜만 정확하게 찾아내는 예제를 살펴보자.

[예문]
http://www.sweeper.com
https://www.sweeper.com/secure
ftp://file.sweeper.com

[정규 표현식]
(?m)^\s*[A-Za-z]{3,}(?=:)

[결과]
http://www.sweeper.com
https://www.sweeper.com/secure
ftp://file.sweeper.com

위에서 사용했던 정규 표현식을 하나씩 까보면...
다중행 지원을 위해 (?m)
프로토콜 앞에 있을지 모르는 공백에 대한 고려를 위해 ^\s*
영문자가 적어도 최소 세 글자는 있어야 하기에 [A-Za-z]{3,}
그리고, :(콜론) 앞으로 찾기 위해 (?=:)

위 예제에서 (?=:)를 사용하였다.
이는 정규 표현식 엔진에게 :(콜론)을 찾되 :(콜론) 앞까지만 일치시키라고 지시한다.

전방 탐색에 대한 이해를 더 깊게 하고자, 위 예제에서 전방탐색 메타 문자를 제거해 보자.

[정규 표현식]
(?m)^\s*[A-Za-z]{3,}(:)

[결과]
http://www.sweeper.com
https://www.sweeper.com/secure
ftp://file.sweeper.com

위 두 예제에서 처음 정규 표현식은 :(콜론)의 앞 위치를 찾고자 (?=:)를 사용했고 두 번째 정규표현식은 (:)를 사용했다.
두 정규 표현식 모두 다음에 나오는 :(콜론)을 찾았지만, 일치한 :(콜론)을 검색 결과에 포함시키는지 아닌지가 다르다.

전방 탐색을 이용하면 정규 표현 분석기는 :(콜론)과 일치하는 지점 앞까지 분석을 진행하지만,
:(콜론) 자체를 찾은 결과로 처리하지는 않는다.

모든 하위 표현식 앞쪽에 단순히 ?= 를 붙이면, 전방 탐색 표현으로 바꿀 수 있다.

하나의 정규 표현식 안에서 여러 개의 전방 탐색 표현식을 사용할 수 있고,
또한 그 전방 탐색 표현식은 정규 표현식 안에서 어느 위치에서든 사용할 수 있다.


3. 후방 탐색 - 뒤로 찾기

후방 탐색은 전방 탐색과 모든 성질이 동일하다 할 수 있다.

다만, 이름의 차이에서 알 수 있듯이 전방 탐색이 일치하는 앞쪽까지의 의미였다면,
후방 탐색은 일치한 뒤쪽부터의 의미를 가진다는 차이가 있다.

후방 탐색은 (?<=일치할 텍스트)의 형식으로 사용한다.
전방 탐색에 비해 ?와 = 사이에 < 부등호가 하나 더 붙어 있는 셈이다.

다음 예제는 데이터베이스의 제품 목록에서 가격만 추려내는 경우다.

[예문]
ABC01: $23.45
HGG42: $5.31
CFMX1: $899.00
XTC99: $69.96

[정규 표현식]
\$[\d\.]+

[결과]
ABC01: $23.45
HGG42: $5.31
CFMX1: $899.00
XTC99: $69.96

잘 동작하지만, $(달러) 기호를 빼야 한다면, 어떻게 해야 할까?
그냥 \$를 정규 표현식에서 빼면 될까?

[정규 표현식]
[\d\.]+

[결과]
ABC01: $23.45
HGG42: $5.31
CFMX1: $899.00
XTC99: $69.96

위 결과와 같이 [숫자, .(마침표)]가 하나 이상인 것들이 모조리 일치해버려, 전혀 엉뚱한 결과가 나와 버렸다.

이럴 때 후방 탐색을 사용하여, $(달러)가 일치한 뒤부터 일치시키게 되면 원하는 결과를 얻을 수 있다.

[정규 표현식]
(?<=\$)[\d\.]+

[결과]
ABC01: $23.45
HGG42: $5.31
CFMX1: $899.00
XTC99: $69.96

제대로 동작한다. (?<=\$)는 $(달러) 기호와 일치하지만, 이를 결과에 포함시키지 않고, 위치에 대한 힌트만 제공하였다.

첫번째와 마지막 예제를 비교해 보자.

\$[\d\.]+는 $(달러)와 금액이 함께 일치하였다.
(?<=\$)[\d\.]+는 $(달러)가 일치한 뒤부터인 금액 숫자 부분만 일치하였다.


4. 전후방 탐색 모두 사용하기

이제 전후방 탐색을 모두 살펴보았으니, 
처음에 살펴보았던 <TITLE>과 </TITLE>사이에 있는 제목만 뽑아내는 예제를 전후방 탐색을 사용하여 완성시켜 보자.

[예문]
<HEAD>
<TITLE>SooKkaRak's homepage</TITLE>
</HEAD>

[정규 표현식]
(?<=\<([Tt][Ii][Tt][Ll][Ee])\>).*?(?=\<\/\1\>)

[결과]
<HEAD>
<TITLE>SooKkaRak's homepage</TITLE>
</HEAD>

<TITLE> 뒤에서부터 제목이 시작하니, 앞에서는 후방 탐색을 사용하였고,
</TITLE> 앞까지 제목이 끝나니, 뒤에서는 전방 탐색을 사용하였다.


5. 부정형 전후방 탐색

지금까지 살펴봤듯이 전후방 탐색은 반환할 텍스트의 위치
즉, 찾고자 하는 부분의 앞뒤를 특별히 지정하고 싶을 때 주로 사용한다.

이런 방법들을 긍정형 전후방 탐색이라고 한다.
긍정이라는 말을 쓰는 이유는 실제로 일치하는 텍스트를 찾기 때문이다.

전후방 탐색 중에서 부정형 탐색은 비교적 덜 쓰는 방법이다.
부정형 전방 탐색은 앞쪽에서 지정한 패턴과 일치하지 않는 텍스트를 찾고,
부정형 후방 탐색도 이와 비슷하게, 뒤쪽에서 지정한 패턴과 일치하지 않는 텍스트를 찾는다.

말 그대로 부정형 전후방 탐색은 (긍정형) 전후방 탐색의 정반대 역할을 한다.

부정형 전후방 탐색은 다음과 같이 사용한다.
부정형 전방 탐색 (?!) <-> (?=) 긍정형 전방 탐색
부정형 후방 탐색 (?<!) <-> (?<=) 긍정형 후방 탐색

즉, 긍정형 전후방 탐색의 = 대신 !를 사용하면 된다.

다음은 긍정형 후방 탐색과 부정형 후방 탐색 사이에 어던 차이가 있는지 알아보는 예제이다.
예제 본문에 가격과 수량을 나타내는 숫자들이 있다.
우선 간단하게 가격만 얻어보자.

[예문]
I paid $30 for 100 apples, 50 oranges, and 60 pears.
I saved $5 on this order.

[정규 표현식]
(?<=\$)\d+

[결과]
I paid $30 for 100 apples, 50 oranges, and 60 pears.
I saved $5 on this order.

이번에는 가격이 아니라, 수량을 찾아보자.

[정규 표현식]
(?<!\$)\d+

[결과]
I paid $30 for 100 apples, 50 oranges, and 60 pears.
I saved $5 on this order.

얼레? $30의 0 역시 $ 다음 위치가 아니기에 덩달아 같이 결과에 포함되어 버렸다.
이럴 땐 깔끔하게 단어 경계를 붙여 문제를 해결하면 되겠다.

[정규 표현식]
\b(?<!\$)\d+\b

[결과]
I paid $30 for 100 apples, 50 oranges, and 60 pears.
I saved $5 on this order.


6. 정리

전후방 탐색을 사용하면, 무엇을 반환할지 더 구체적으로 명시할 수 있다.

전투방 탐색 명령어는 하위 표현식을 통해 텍스트의 위치를 지정하지만, 소비하지는 않는다.
일치하지만, 검색 결과 텍스트에는 포함되지 않는다는 뜻이다.

전후방 탐색 명령어는 다음과 같은 것들이 있다.
긍정형 전방 탐색 : (?=)
부정형 전방 탐색 : (?!)
긍정형 후방 탐색 : (?<=)
부정형 후방 탐색 : (?<!)
출처:정규 표현식 - 전후방 탐색(lookaround)
```